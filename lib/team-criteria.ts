// ข้อมูลเกณฑ์ทักษะและบุคลิกภาพที่ต้องการสำหรับแต่ละทีม
export const teamCriteria = {
  "NET ZERO": {
    skills: [
      {
        name: "Climate Strategy & Carbon Accounting",
        category: "Sustainability & ESG",
        subcategory: "Climate Strategy & Carbon Accounting",
        priority: 1,
        explanation: "Foundational for developing and implementing carbon reduction and sustainability strategies.",
      },
      {
        name: "Strategic Thinking",
        category: "Business & Strategy",
        subcategory: "Strategic Thinking & Business Planning",
        priority: 2,
        explanation: "Essential for planning long-term, impactful sustainability initiatives.",
      },
      {
        name: "Collaboration",
        category: "Soft Skills",
        subcategory: "Collaboration Skills",
        priority: 3,
        explanation: "Key to aligning diverse teams and stakeholders on climate action goals.",
      },
      {
        name: "Data Analytics",
        category: "Technology & Digital Skills",
        subcategory: "Data & Analytics",
        priority: 4,
        explanation: "Supports accurate monitoring and assessment of environmental metrics.",
      },
      {
        name: "ESG Reporting & Compliance",
        category: "Sustainability & ESG",
        subcategory: "ESG Reporting & Compliance",
        priority: 5,
        explanation: "Ensures adherence to sustainability regulations and transparency.",
      },
    ],
    personality_traits: [
      {
        name: "Conceptual",
        explanation: "Encourages creative approaches to climate and sustainability challenges.",
      },
      {
        name: "Structure",
        explanation: "Supports organized implementation of complex environmental plans.",
      },
      {
        name: "Cooperativeness",
        explanation: "Promotes team alignment and shared responsibility in sustainable projects.",
      },
    ],
  },
  "Private Equity": {
    skills: [
      {
        name: "Analytical",
        category: "Soft Skills",
        subcategory: "Work Productivity Skills",
        priority: 1,
        explanation: "Critical for evaluating investment opportunities and financial performance.",
      },
      {
        name: "Risk Management",
        category: "Business & Strategy",
        subcategory: "Strategic Thinking & Risk Management",
        priority: 2,
        explanation: "Core to protecting assets and managing uncertainty in investments.",
      },
      {
        name: "Financial Acumen",
        category: "Business & Strategy",
        subcategory: "Strategic Thinking & Business Planning",
        priority: 3,
        explanation: "Required for interpreting financial data and market trends.",
      },
      {
        name: "Decision Making",
        category: "Soft Skills",
        subcategory: "Work Productivity Skills",
        priority: 4,
        explanation: "Supports fast, confident decisions in high-stakes environments.",
      },
      {
        name: "Collaboration",
        category: "Soft Skills",
        subcategory: "Collaboration Skills",
        priority: 5,
        explanation: "Ensures synergy among analysts, risk managers, and domain experts.",
      },
    ],
    personality_traits: [
      {
        name: "Drive",
        explanation: "Reflects the ambition and energy needed to succeed in competitive markets.",
      },
      {
        name: "Assertiveness",
        explanation: "Enables confident expression of opinions and firm decision-making.",
      },
      {
        name: "Awareness",
        explanation: "Allows careful consideration of both risks and opportunities.",
      },
    ],
  },
  "Board Directors": {
    skills: [
      {
        name: "Governance",
        category: "Business & Strategy",
        subcategory: "Governance & Oversight",
        priority: 1,
        explanation: "Central to defining and upholding corporate governance practices.",
      },
      {
        name: "Strategic Thinking",
        category: "Business & Strategy",
        subcategory: "Strategic Thinking & Business Planning",
        priority: 2,
        explanation: "Guides high-level planning and oversight.",
      },
      {
        name: "Decision Making",
        category: "Soft Skills",
        subcategory: "Work Productivity Skills",
        priority: 3,
        explanation: "Vital for evaluating options and approving key initiatives.",
      },
      {
        name: "Communication Skills",
        category: "Soft Skills",
        subcategory: "Collaboration Skills",
        priority: 4,
        explanation: "Ensures effective discussion and articulation of policies.",
      },
      {
        name: "Leadership",
        category: "Soft Skills",
        subcategory: "Work-Oriented Skills",
        priority: 5,
        explanation: "Influences strategic direction and board cohesion.",
      },
    ],
    personality_traits: [
      {
        name: "Composure",
        explanation: "Maintains clarity and calm during board deliberations.",
      },
      {
        name: "Power",
        explanation: "Drives confident leadership and board presence.",
      },
      {
        name: "Structure",
        explanation: "Supports disciplined decision-making and adherence to policy.",
      },
    ],
  },
  "Global Mindset": {
    skills: [
      {
        name: "Cross-Cultural Skills",
        category: "Soft Skills",
        subcategory: "Interpersonal & Social Skills",
        priority: 1,
        explanation: "Enables effective interaction across diverse cultural contexts.",
      },
      {
        name: "Language Skills",
        category: "Soft Skills",
        subcategory: "Culture & Language",
        priority: 2,
        explanation: "Facilitates direct communication with global teams.",
      },
      {
        name: "Client & Stakeholder Management",
        category: "Business & Strategy",
        subcategory: "Client & Stakeholder Management",
        priority: 3,
        explanation: "Supports relationship-building across geographies.",
      },
      {
        name: "Adaptability",
        category: "Soft Skills",
        subcategory: "Growth & Adaptability",
        priority: 4,
        explanation: "Helps navigate change and cultural complexity.",
      },
      {
        name: "Strategic Thinking",
        category: "Business & Strategy",
        subcategory: "Strategic Thinking & Business Planning",
        priority: 5,
        explanation: "Enables global planning and market entry strategies.",
      },
    ],
    personality_traits: [
      {
        name: "Flexibility",
        explanation: "Enables smooth adaptation to cultural and situational changes.",
      },
      {
        name: "Positivity",
        explanation: "Promotes open, friendly global collaboration.",
      },
      {
        name: "Liveliness",
        explanation: "Energizes international engagements and team dynamics.",
      },
    ],
  },
  "Future Capabilities": {
    skills: [
      {
        name: "Digital Savvy",
        category: "Technology & Digital Skills",
        subcategory: "Digital Literacy",
        priority: 1,
        explanation: "Enables understanding and application of emerging technologies.",
      },
      {
        name: "Innovation",
        category: "Technology & Digital Skills",
        subcategory: "General Digital Literacy",
        priority: 2,
        explanation: "Drives the creation of new solutions and competitive advantages.",
      },
      {
        name: "Energy Trading Knowledge",
        category: "Sustainability & ESG",
        subcategory: "Energy & Resource Economics",
        priority: 3,
        explanation: "Essential for operational success in the energy sector.",
      },
      {
        name: "Strategic Thinking",
        category: "Business & Strategy",
        subcategory: "Strategic Thinking & Business Planning",
        priority: 4,
        explanation: "Supports long-term planning in volatile markets.",
      },
      {
        name: "Problem Solving",
        category: "Soft Skills",
        subcategory: "Work Productivity Skills",
        priority: 5,
        explanation: "Crucial for overcoming technical and market challenges.",
      },
    ],
    personality_traits: [
      {
        name: "Ambition",
        explanation: "Pushes the team to explore bold ideas and disruptive technologies.",
      },
      {
        name: "Conceptual",
        explanation: "Drives innovative thinking and future-focused strategies.",
      },
      {
        name: "Mastery",
        explanation: "Demonstrates deep commitment to excellence and skill refinement.",
      },
    ],
  },
}

// ฟังก์ชันสำหรับคำนวณความเหมาะสมของพนักงานกับทีม
export function calculateTeamFit(
  employee: any,
  teamName: string,
): {
  skillFit: number
  personalityFit: number
  overallFit: number
  matchedSkills: string[]
  matchedPersonality: string[]
  missingSkills: string[]
  missingPersonality: string[]
} {
  // ถ้าไม่มีข้อมูลเกณฑ์ของทีม ให้คืนค่าเริ่มต้น
  if (!teamCriteria[teamName as keyof typeof teamCriteria]) {
    return {
      skillFit: 0,
      personalityFit: 0,
      overallFit: 0,
      matchedSkills: [],
      matchedPersonality: [],
      missingSkills: [],
      missingPersonality: [],
    }
  }

  const criteria = teamCriteria[teamName as keyof typeof teamCriteria]

  // คำนวณความเหมาะสมด้านทักษะ
  let skillScore = 0
  const matchedSkills: string[] = []
  const missingSkills: string[] = []

  // ตรวจสอบทักษะที่ต้องการของทีม
  criteria.skills.forEach((skill) => {
    // ตรวจสอบว่าพนักงานมีทักษะนี้หรือไม่
    const hasSkill = employee.skills?.some(
      (empSkill: any) =>
        empSkill.name.toLowerCase().includes(skill.name.toLowerCase()) ||
        (empSkill.main_category && empSkill.main_category.toLowerCase().includes(skill.category.toLowerCase())),
    )

    if (hasSkill) {
      // ให้คะแนนตามความสำคัญของทักษะ (priority 1 มีค่ามากที่สุด)
      skillScore += (6 - skill.priority) * 5 // คะแนนสูงสุด 25 คะแนนต่ำสุด 5
      matchedSkills.push(skill.name)
    } else {
      missingSkills.push(skill.name)
    }
  })

  // คำนวณเป็นเปอร์เซ็นต์ (เต็ม 100%)
  const maxSkillScore = criteria.skills.reduce((sum, skill) => sum + (6 - skill.priority) * 5, 0)
  const skillFit = Math.round((skillScore / maxSkillScore) * 100)

  // คำนวณความเหมาะสมด้านบุคลิกภาพ
  let personalityScore = 0
  const matchedPersonality: string[] = []
  const missingPersonality: string[] = []

  // ตรวจสอบบุคลิกภาพที่ต้องการของทีม
  criteria.personality_traits.forEach((trait, index) => {
    // ตรวจสอบว่าพนักงานมีบุคลิกภาพนี้หรือไม่
    const hasTrait =
      employee.personality_traits &&
      (employee.personality_traits.top_personality?.toLowerCase().includes(trait.name.toLowerCase()) ||
        employee.personality_traits.second_personality?.toLowerCase().includes(trait.name.toLowerCase()) ||
        (employee.personality_traits.sorted_traits &&
          employee.personality_traits.sorted_traits.toLowerCase().includes(trait.name.toLowerCase())))

    if (hasTrait) {
      // ให้คะแนนตามลำดับความสำคัญ (ลำดับแรกมีค่ามากที่สุด)
      personalityScore += (3 - index) * 10 // คะแนนสูงสุด 30 คะแนนต่ำสุด 10
      matchedPersonality.push(trait.name)
    } else {
      missingPersonality.push(trait.name)
    }
  })

  // คำนวณเป็นเปอร์เซ็นต์ (เต็ม 100%)
  const maxPersonalityScore = criteria.personality_traits.reduce((sum, _, index) => sum + (3 - index) * 10, 0)
  const personalityFit = Math.round((personalityScore / maxPersonalityScore) * 100)

  // คำนวณความเหมาะสมโดยรวม (ทักษะมีน้ำหนัก 70%, บุคลิกภาพมีน้ำหนัก 30%)
  const overallFit = Math.round(skillFit * 0.7 + personalityFit * 0.3)

  return {
    skillFit,
    personalityFit,
    overallFit,
    matchedSkills,
    matchedPersonality,
    missingSkills,
    missingPersonality,
  }
}

// ฟังก์ชันสำหรับคำนวณความเหมาะสมของทีมโดยรวม
export function calculateTeamComposition(
  team: any,
  members: any[],
): {
  overallFit: number
  skillCoverage: number
  personalityCoverage: number
  missingSkills: string[]
  missingPersonality: string[]
} {
  // ถ้าไม่มีข้อมูลทีมหรือสมาชิก ให้คืนค่าเริ่มต้น
  if (!team || !members || members.length === 0) {
    return {
      overallFit: 0,
      skillCoverage: 0,
      personalityCoverage: 0,
      missingSkills: [],
      missingPersonality: [],
    }
  }

  // ดึงชื่อทีมจากคำอธิบายทีม
  let teamName = "NET ZERO" // ค่าเริ่มต้น

  // ตรวจสอบว่าคำอธิบายทีมมีคำสำคัญของทีมใดบ้าง
  const teamKeywords = {
    "NET ZERO": ["net zero", "carbon", "climate", "sustainability", "esg"],
    "Private Equity": ["private equity", "investment", "finance", "fund", "portfolio"],
    "Board Directors": ["board", "director", "governance", "oversight", "committee"],
    "Global Mindset": ["global", "international", "cross-cultural", "worldwide", "multinational"],
    "Future Capabilities": ["future", "innovation", "digital", "technology", "transformation"],
  }

  // หาทีมที่ตรงกับคำอธิบายมากที่สุด
  let maxMatches = 0
  Object.entries(teamKeywords).forEach(([name, keywords]) => {
    const matches = keywords.filter((keyword) => team.description.toLowerCase().includes(keyword.toLowerCase())).length

    if (matches > maxMatches) {
      maxMatches = matches
      teamName = name
    }
  })

  // ถ้าไม่มีข้อมูลเกณฑ์ของทีม ให้คืนค่าเริ่มต้น
  if (!teamCriteria[teamName as keyof typeof teamCriteria]) {
    return {
      overallFit: 0,
      skillCoverage: 0,
      personalityCoverage: 0,
      missingSkills: [],
      missingPersonality: [],
    }
  }

  const criteria = teamCriteria[teamName as keyof typeof teamCriteria]

  // รวบรวมทักษะและบุคลิกภาพของสมาชิกทั้งหมด
  const teamSkills = new Set<string>()
  const teamPersonality = new Set<string>()

  members.forEach((member) => {
    // เพิ่มทักษะของสมาชิก
    member.skills?.forEach((skill: any) => {
      teamSkills.add(skill.name.toLowerCase())
      if (skill.main_category) {
        teamSkills.add(skill.main_category.toLowerCase())
      }
    })

    // เพิ่มบุคลิกภาพของสมาชิก
    if (member.personality_traits) {
      if (member.personality_traits.top_personality) {
        teamPersonality.add(member.personality_traits.top_personality.toLowerCase())
      }
      if (member.personality_traits.second_personality) {
        teamPersonality.add(member.personality_traits.second_personality.toLowerCase())
      }
      if (member.personality_traits.sorted_traits) {
        const traits = member.personality_traits.sorted_traits
          .split(",")
          .map((t: string) => t.split(":")[0].trim().toLowerCase())
        traits.forEach((t: string) => teamPersonality.add(t))
      }
    }
  })

  // ตรวจสอบทักษะที่ต้องการของทีม
  const missingSkills: string[] = []
  let coveredSkills = 0

  criteria.skills.forEach((skill) => {
    const isCovered = Array.from(teamSkills).some(
      (teamSkill) => teamSkill.includes(skill.name.toLowerCase()) || skill.category.toLowerCase().includes(teamSkill),
    )

    if (isCovered) {
      coveredSkills++
    } else {
      missingSkills.push(skill.name)
    }
  })

  // คำนวณความครอบคลุมทักษะเป็นเปอร์เซ็นต์
  const skillCoverage = Math.round((coveredSkills / criteria.skills.length) * 100)

  // ตรวจสอบบุคลิกภาพที่ต้องการของทีม
  const missingPersonality: string[] = []
  let coveredPersonality = 0

  criteria.personality_traits.forEach((trait) => {
    const isCovered = Array.from(teamPersonality).some((teamTrait) => teamTrait.includes(trait.name.toLowerCase()))

    if (isCovered) {
      coveredPersonality++
    } else {
      missingPersonality.push(trait.name)
    }
  })

  // คำนวณความครอบคลุมบุคลิกภาพเป็นเปอร์เซ็นต์
  const personalityCoverage = Math.round((coveredPersonality / criteria.personality_traits.length) * 100)

  // คำนวณความเหมาะสมโดยรวม (ทักษะมีน้ำหนัก 70%, บุคลิกภาพมีน้ำหนัก 30%)
  const overallFit = Math.round(skillCoverage * 0.7 + personalityCoverage * 0.3)

  return {
    overallFit,
    skillCoverage,
    personalityCoverage,
    missingSkills,
    missingPersonality,
  }
}
